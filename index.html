<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­è³‡é‡‘é‹ç”¨æˆ°æƒ…å®¤ (Proç‰ˆ)</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 1.5rem; height: 100%; }
        .input-row { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center; }
        .btn-add { background-color: #ecfdf5; color: #059669; border: 1px dashed #059669; width: 100%; padding: 0.5rem; border-radius: 0.375rem; transition: 0.2s; }
        .btn-add:hover { background-color: #d1fae5; }
        .btn-del { color: #ef4444; cursor: pointer; padding: 0 5px; }
        .money-text { font-family: 'Courier New', Courier, monospace; font-weight: bold; }
        .section-header { border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        input, select { border: 1px solid #d1d5db; padding: 0.4rem; border-radius: 0.25rem; font-size: 0.9rem; }
    </style>
</head>
<body>

<div id="app" class="p-4 max-w-[1400px] mx-auto">
    <h1 class="text-3xl font-bold text-slate-700 mb-6 text-center">ğŸ“Š å®¶åº­è³‡é‡‘é‹ç”¨æˆ°æƒ…å®¤ <span class="text-sm font-normal text-slate-500">Pro è©³ç´°ç‰ˆ</span></h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        
        <div class="card border-t-4 border-blue-500">
            <div class="section-header">
                <h2 class="text-xl font-bold text-blue-700">ğŸ‘¨ ç”·ç”Ÿè²¡å‹™</h2>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-600">æœˆè–ªè³‡</label>
                    <input type="number" v-model.number="male.salary" class="w-full">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-600">æ’¥å…¥å…±åŒå¸³æˆ¶</label>
                    <input type="number" v-model.number="male.contrib" class="w-full bg-blue-50">
                </div>
                
                <hr>
                <h3 class="font-bold text-gray-600">å€‹äººé–‹éŠ·ç´°é … (æ‰£é™¤å…¬è²»å¾Œ)</h3>
                <div v-for="(item, index) in male.expenses" :key="index" class="input-row">
                    <input type="text" v-model="item.name" placeholder="é …ç›®" class="w-1/3">
                    <input type="number" v-model.number="item.amount" placeholder="é‡‘é¡" class="w-1/3">
                    <select v-model="item.freq" class="w-1/4 text-xs">
                        <option :value="1">æ¯æœˆ</option>
                        <option :value="2">æ¯2æœˆ</option>
                        <option :value="12">æ¯å¹´</option>
                    </select>
                    <span class="btn-del" @click="removeRow(male.expenses, index)">âœ•</span>
                </div>
                <button class="btn-add" @click="addRow(male.expenses)">+ æ–°å¢å€‹äººé–‹éŠ·</button>
            </div>
            <div class="mt-4 p-3 bg-blue-100 rounded text-right">
                <div class="text-xs text-blue-600">æœˆå‡å€‹äººç¸½æ”¯å‡º</div>
                <div class="text-xl font-bold text-blue-800">{{ formatMoney(calcTotalMonthly(male.expenses)) }}</div>
            </div>
        </div>

        <div class="card border-t-4 border-pink-500">
            <div class="section-header">
                <h2 class="text-xl font-bold text-pink-700">ğŸ‘© å¥³ç”Ÿè²¡å‹™</h2>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-600">æœˆè–ªè³‡</label>
                    <input type="number" v-model.number="female.salary" class="w-full">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-600">æ’¥å…¥å…±åŒå¸³æˆ¶</label>
                    <input type="number" v-model.number="female.contrib" class="w-full bg-pink-50">
                </div>
                
                <hr>
                <h3 class="font-bold text-gray-600">å€‹äººé–‹éŠ·ç´°é … (æ‰£é™¤å…¬è²»å¾Œ)</h3>
                <div v-for="(item, index) in female.expenses" :key="index" class="input-row">
                    <input type="text" v-model="item.name" placeholder="é …ç›®" class="w-1/3">
                    <input type="number" v-model.number="item.amount" placeholder="é‡‘é¡" class="w-1/3">
                    <select v-model="item.freq" class="w-1/4 text-xs">
                        <option :value="1">æ¯æœˆ</option>
                        <option :value="2">æ¯2æœˆ</option>
                        <option :value="12">æ¯å¹´</option>
                    </select>
                    <span class="btn-del" @click="removeRow(female.expenses, index)">âœ•</span>
                </div>
                <button class="btn-add" @click="addRow(female.expenses)">+ æ–°å¢å€‹äººé–‹éŠ·</button>
            </div>
            <div class="mt-4 p-3 bg-pink-100 rounded text-right">
                <div class="text-xs text-pink-600">æœˆå‡å€‹äººç¸½æ”¯å‡º</div>
                <div class="text-xl font-bold text-pink-800">{{ formatMoney(calcTotalMonthly(female.expenses)) }}</div>
            </div>
        </div>

        <div class="card border-t-4 border-green-500">
            <div class="section-header">
                <h2 class="text-xl font-bold text-green-700">ğŸ  å…±åŒå¸³æˆ¶ & é–‹éŠ·</h2>
                <div class="text-sm text-green-600 bg-green-100 px-2 py-1 rounded">
                    æœˆæ”¶å…¥: {{ formatMoney(male.contrib + female.contrib) }}
                </div>
            </div>

            <div class="space-y-2">
                <h3 class="font-bold text-gray-600">å…±åŒæ”¯å‡ºç´°é …</h3>
                <div class="text-xs text-gray-400 mb-2">å¯è¨­å®šé »ç‡ï¼Œä¾‹å¦‚ï¼šæ°´é›»é¸ã€Œæ¯2æœˆã€ï¼Œæˆ¿å±‹ç¨…é¸ã€Œæ¯å¹´ã€</div>
                
                <div v-for="(item, index) in joint.expenses" :key="index" class="input-row">
                    <input type="text" v-model="item.name" placeholder="é …ç›®" class="w-1/3">
                    <input type="number" v-model.number="item.amount" placeholder="é‡‘é¡" class="w-1/3">
                    <select v-model="item.freq" class="w-1/4 text-xs">
                        <option :value="1">æ¯æœˆ</option>
                        <option :value="2">æ¯2æœˆ</option>
                        <option :value="12">æ¯å¹´</option>
                    </select>
                    <span class="btn-del" @click="removeRow(joint.expenses, index)">âœ•</span>
                </div>
                <button class="btn-add" @click="addRow(joint.expenses)">+ æ–°å¢å…±åŒé–‹éŠ·</button>
            </div>
            
            <div class="mt-4 p-3 bg-green-100 rounded">
                <div class="flex justify-between items-end">
                    <div class="text-sm">
                        <div class="text-gray-600">æœˆå‡ç¸½æ”¯å‡º</div>
                        <div class="text-gray-600">æ¯æœˆç›ˆé¤˜</div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-red-600">- {{ formatMoney(calcTotalMonthly(joint.expenses)) }}</div>
                        <div :class="jointSurplus >= 0 ? 'text-green-700' : 'text-red-600'" class="text-2xl font-bold">
                            {{ formatMoney(jointSurplus) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <div class="card bg-slate-800 text-white">
            <h2 class="text-2xl font-bold text-yellow-400 mb-4">ğŸ’° å¹´åº¦æŠ•è³‡æ½›åŠ›åˆ†æ</h2>
            
            <div class="mb-6">
                <label class="block text-sm text-gray-300 mb-1">å¹´åº¦çé‡‘è¨­å®š (æœˆè–ªå€æ•¸)</label>
                <div class="flex items-center gap-2">
                    <input type="number" v-model.number="bonusMonths" class="text-black w-20 p-1">
                    <span class="text-sm text-gray-400">å€‹æœˆ (ä¸‰ç¯€+å¹´çµ‚)</span>
                </div>
            </div>

            <div class="space-y-4">
                <div class="flex justify-between border-b border-slate-600 pb-2">
                    <span>1. æ¯æœˆçµé¤˜ç´¯ç© (12å€‹æœˆ)</span>
                    <span class="font-mono text-yellow-200">{{ formatMoney(totalMonthlySurplusYearly) }}</span>
                </div>
                <div class="pl-4 text-xs text-gray-400 space-y-1">
                    <div class="flex justify-between"><span>â€¢ ç”·æ–¹å€‹äººæ¯æœˆå‰©é¤˜</span> <span>{{ formatMoney(male.salary - male.contrib - calcTotalMonthly(male.expenses)) }} /æœˆ</span></div>
                    <div class="flex justify-between"><span>â€¢ å¥³æ–¹å€‹äººæ¯æœˆå‰©é¤˜</span> <span>{{ formatMoney(female.salary - female.contrib - calcTotalMonthly(female.expenses)) }} /æœˆ</span></div>
                    <div class="flex justify-between"><span>â€¢ å…±åŒå¸³æˆ¶æ¯æœˆç›ˆé¤˜</span> <span>{{ formatMoney(jointSurplus) }} /æœˆ</span></div>
                </div>

                <div class="flex justify-between border-b border-slate-600 pb-2">
                    <span>2. å¹´åº¦çé‡‘ç¸½é¡ (éš±è—è²¡å¯Œ)</span>
                    <span class="font-mono text-purple-300">{{ formatMoney(totalBonusYearly) }}</span>
                </div>
                
                <div class="flex justify-between items-center pt-2">
                    <span class="text-lg font-bold">ğŸš€ å¹´åº¦å¯æŠ•å…¥æŠ•è³‡ç¸½é¡</span>
                    <span class="text-3xl font-bold text-green-400">{{ formatMoney(totalInvestable) }}</span>
                </div>
            </div>

            <div v-if="jointSurplus < 0" class="mt-4 p-3 bg-red-900/50 border border-red-500 rounded text-red-200 text-sm">
                âš ï¸ <strong>è­¦å‘Šï¼š</strong> å…±åŒå¸³æˆ¶ç›®å‰æ¯æœˆé€æ”¯ {{ formatMoney(Math.abs(jointSurplus)) }} å…ƒï¼<br>
                å»ºè­°å„ªå…ˆå¾å€‹äººç›ˆé¤˜å¡«è£œï¼Œæˆ–æ¸›å°‘å…±åŒé–‹éŠ·ï¼Œå¦å‰‡æœƒä¾µè•æŠ•è³‡æœ¬é‡‘ã€‚
            </div>
        </div>

        <div class="card">
            <h3 class="font-bold text-gray-700 mb-4">è³‡é‡‘æµå‘åˆ†ä½ˆ</h3>
            <div class="h-64">
                <canvas id="financeChart"></canvas>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, watch, onMounted } = Vue;

    createApp({
        setup() {
            // --- åˆå§‹è³‡æ–™ (é è¨­ç¯„ä¾‹) ---
            const bonusMonths = ref(5);
            
            const male = ref({
                salary: 60000,
                contrib: 30000,
                expenses: [
                    { name: 'æ‰‹æ©Ÿè²»', amount: 999, freq: 1 },
                    { name: 'åŠ æ²¹/äº¤é€š', amount: 3000, freq: 1 },
                    { name: 'å­è¦ªè²»', amount: 5000, freq: 1 },
                    { name: 'æ±½è»Šéšª', amount: 12000, freq: 12 }, // å¹´ç¹³
                ]
            });

            const female = ref({
                salary: 45000,
                contrib: 15000,
                expenses: [
                    { name: 'åŒ–å¦/ä¿é¤Š', amount: 2000, freq: 1 },
                    { name: 'å­è¦ªè²»', amount: 5000, freq: 1 },
                    { name: 'é†«ç™‚éšª', amount: 24000, freq: 12 }, // å¹´ç¹³
                ]
            });

            const joint = ref({
                expenses: [
                    { name: 'æˆ¿è²¸', amount: 25000, freq: 1 },
                    { name: 'ç®¡ç†è²»', amount: 2500, freq: 1 },
                    { name: 'ç¶²è·¯è²»', amount: 800, freq: 1 },
                    { name: 'é›»è²»', amount: 3000, freq: 2 },  // æ¯å…©æœˆ
                    { name: 'æ°´è²»', amount: 500, freq: 2 },   // æ¯å…©æœˆ
                    { name: 'æˆ¿å±‹/åœ°åƒ¹ç¨…', amount: 8000, freq: 12 }, // æ¯å¹´
                    { name: 'å…±åŒé£²é£Ÿ/æ—¥ç”¨', amount: 12000, freq: 1 },
                ]
            });

            // --- è¨ˆç®—é‚è¼¯ ---
            // è¨ˆç®—åˆ—è¡¨çš„æœˆå‡ç¸½åˆ: é‡‘é¡ / é »ç‡
            const calcTotalMonthly = (list) => {
                return list.reduce((sum, item) => sum + (item.amount / item.freq), 0);
            };

            const jointSurplus = computed(() => {
                const income = male.value.contrib + female.value.contrib;
                const expense = calcTotalMonthly(joint.value.expenses);
                return income - expense;
            });

            const totalMonthlySurplusYearly = computed(() => {
                const mSurplus = male.value.salary - male.value.contrib - calcTotalMonthly(male.value.expenses);
                const fSurplus = female.value.salary - female.value.contrib - calcTotalMonthly(female.value.expenses);
                const jSurplus = jointSurplus.value;
                return (mSurplus + fSurplus + jSurplus) * 12;
            });

            const totalBonusYearly = computed(() => {
                return (male.value.salary + female.value.salary) * bonusMonths.value;
            });

            const totalInvestable = computed(() => {
                return totalMonthlySurplusYearly.value + totalBonusYearly.value;
            });

            // --- åŠŸèƒ½å‡½æ•¸ ---
            const addRow = (list) => {
                list.push({ name: '', amount: 0, freq: 1 });
            };
            const removeRow = (list, index) => {
                list.splice(index, 1);
            };
            const formatMoney = (val) => {
                return Math.round(val).toLocaleString();
            };

            // --- åœ–è¡¨ç¹ªè£½ ---
            let chartInstance = null;
            const updateChart = () => {
                const ctx = document.getElementById('financeChart').getContext('2d');
                if(chartInstance) chartInstance.destroy();

                const mExp = calcTotalMonthly(male.value.expenses);
                const fExp = calcTotalMonthly(female.value.expenses);
                const jExp = calcTotalMonthly(joint.value.expenses);
                
                // è¨ˆç®—çœŸæ­£çš„ã€Œæ·¨å„²è“„ã€(å«çé‡‘å¹³å‡åˆ°æ¯æœˆ)
                const monthlyBonusAvg = totalBonusYearly.value / 12;
                const totalIncomeMonthly = male.value.salary + female.value.salary + monthlyBonusAvg;
                const investPotential = totalInvestable.value / 12;

                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['è³‡é‡‘åˆ†é… (æœˆå‡)'],
                        datasets: [
                            { label: 'å…±åŒæ”¯å‡º', data: [jExp], backgroundColor: '#10b981' }, // Green
                            { label: 'ç”·ç”Ÿå€‹äººé–‹éŠ·', data: [mExp], backgroundColor: '#3b82f6' }, // Blue
                            { label: 'å¥³ç”Ÿå€‹äººé–‹éŠ·', data: [fExp], backgroundColor: '#ec4899' }, // Pink
                            { label: 'å¯æŠ•è³‡/å„²è“„ (å«çé‡‘)', data: [investPotential], backgroundColor: '#f59e0b' } // Yellow
                        ]
                    },
                    options: {
                        indexAxis: 'y', // æ©«å‘é•·æ¢åœ–
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { x: { stacked: true }, y: { stacked: true } }
                    }
                });
            };

            // ç›£è½æ•¸æ“šè®ŠåŒ–è‡ªå‹•æ›´æ–°åœ–è¡¨
            watch([male, female, joint, bonusMonths], () => {
                updateChart();
            }, { deep: true });

            onMounted(() => {
                updateChart();
            });

            return {
                male, female, joint, bonusMonths,
                calcTotalMonthly, jointSurplus,
                totalMonthlySurplusYearly, totalBonusYearly, totalInvestable,
                addRow, removeRow, formatMoney
            };
        }
    }).mount('#app');
</script>

</body>
</html>
