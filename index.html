<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­è³‡é‡‘é‹ç”¨æˆ°æƒ…å®¤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: flex; gap: 20px; flex-wrap: wrap; }
        
        /* å·¦å´è¼¸å…¥å€ */
        .input-section { flex: 1; min-width: 300px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h3 { color: #34495e; margin-top: 20px; font-size: 1.1em; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="number"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 20px; transition: background 0.3s; }
        .btn:hover { background-color: #2980b9; }

        /* å³å´åœ–è¡¨å€ */
        .chart-section { flex: 1.5; min-width: 400px; display: flex; flex-direction: column; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .result-box { background: #e8f6f3; padding: 15px; border-radius: 5px; margin-top: 10px; border-left: 5px solid #1abc9c; }
        .alert-box { background: #fdedec; padding: 15px; border-radius: 5px; margin-top: 10px; border-left: 5px solid #e74c3c; display: none; }
        
        /* Canvas å¤§å°æ§åˆ¶ */
        .canvas-container { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body>

<div class="container">
    <div class="input-section">
        <h2>ğŸ“Š åƒæ•¸è¨­å®š</h2>
        
        <h3>ğŸ‘¤ æ”¶å…¥è¨­å®š (æœˆè–ª)</h3>
        <div class="form-group"><label>ç”·ç”Ÿæœˆè–ª</label><input type="number" id="salaryMale" value="60000"></div>
        <div class="form-group"><label>å¥³ç”Ÿæœˆè–ª</label><input type="number" id="salaryFemale" value="45000"></div>

        <h3>ğŸ¦ å…±åŒå¸³æˆ¶æŠ•å…¥ (æ¯æœˆ)</h3>
        <div class="form-group"><label>ç”·ç”ŸæŠ•å…¥é‡‘é¡</label><input type="number" id="contribMale" value="30000"></div>
        <div class="form-group"><label>å¥³ç”ŸæŠ•å…¥é‡‘é¡</label><input type="number" id="contribFemale" value="15000"></div>

        <h3>ğŸ  å…±åŒæ”¯å‡º (æ¯æœˆ)</h3>
        <div class="form-group"><label>æˆ¿è²¸</label><input type="number" id="expMortgage" value="25000"></div>
        <div class="form-group"><label>ç”Ÿæ´»é›œæ”¯ (æ°´é›»/é¤è²»/ç¶²è·¯)</label><input type="number" id="expLiving" value="15000"></div>

        <h3>ğŸ§§ çé‡‘è¨­å®š</h3>
        <div class="form-group">
            <label>å¹´åº¦é ˜å–çé‡‘ç¸½æœˆæ•¸ (å«ä¸‰ç¯€+å¹´çµ‚)</label>
            <input type="number" id="bonusMonths" value="5" title="ä¾‹å¦‚ï¼š5/1+ç«¯åˆ+ä¸­ç§‹=3å€‹æœˆï¼Œå¹´çµ‚2å€‹æœˆï¼Œå…±5å€‹æœˆ">
        </div>

        <button class="btn" onclick="calculate()">æ›´æ–°è©¦ç®—çµæœ</button>
    </div>

    <div class="chart-section">
        
        <div class="card">
            <h2>ğŸ“ è²¡å‹™å¥æª¢çµè«–</h2>
            <div id="alertBox" class="alert-box">âš ï¸ è­¦å‘Šï¼šå…±åŒå¸³æˆ¶æ¯æœˆé€æ”¯ï¼Œè«‹å¢åŠ æŠ•å…¥é‡‘é¡æˆ–æ¸›å°‘é–‹éŠ·ï¼</div>
            <div class="result-box">
                <p><strong>å…±åŒå¸³æˆ¶é¤˜é¡ï¼š</strong> <span id="valJointBalance">0</span> å…ƒ/æœˆ</p>
                <p><strong>å…©äººç§æˆ¿éŒ¢ç¸½å‰©é¤˜ï¼š</strong> <span id="valPersonalLeft">0</span> å…ƒ/æœˆ (å·²æ‰£é™¤å…¬è²»)</p>
                <hr>
                <p style="color: #2c3e50; font-size: 1.2em;"><strong>ğŸ’° å¹´åº¦å¯æŠ•è³‡ ETF ç¸½é¡ï¼š <span id="valTotalInvest" style="color: #d35400;">0</span> å…ƒ</strong></p>
                <small>(åŒ…å«æ¯æœˆçµé¤˜ + å…¨æ•¸å¹´åº¦çé‡‘)</small>
            </div>
        </div>

        <div class="card">
            <h3>å…±åŒå¸³æˆ¶è³‡é‡‘åˆ†é… (æœˆåº¦)</h3>
            <div class="canvas-container">
                <canvas id="jointChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>å¹´åº¦è²¡å¯Œä¾†æºåˆ†æ (çé‡‘ vs æœˆå­˜)</h3>
            <div class="canvas-container">
                <canvas id="yearChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    // åˆå§‹åŒ–å…¨åŸŸè®Šæ•¸ä¾†å­˜å„²åœ–è¡¨å¯¦ä¾‹
    let jointChartInstance = null;
    let yearChartInstance = null;

    function calculate() {
        // 1. ç²å–è¼¸å…¥å€¼
        const salaryMale = Number(document.getElementById('salaryMale').value);
        const salaryFemale = Number(document.getElementById('salaryFemale').value);
        const contribMale = Number(document.getElementById('contribMale').value);
        const contribFemale = Number(document.getElementById('contribFemale').value);
        
        const expMortgage = Number(document.getElementById('expMortgage').value);
        const expLiving = Number(document.getElementById('expLiving').value);
        const bonusMonths = Number(document.getElementById('bonusMonths').value);

        // 2. é‚è¼¯è¨ˆç®—
        // å…±åŒå¸³æˆ¶
        const jointIncome = contribMale + contribFemale;
        const jointExpenseTotal = expMortgage + expLiving;
        const jointBalance = jointIncome - jointExpenseTotal;

        // å€‹äººå‰©é¤˜ (é€™è£¡ç°¡åŒ–è¨ˆç®—ï¼Œå‡è¨­å€‹äººå‰©é¤˜ = è–ªæ°´ - å…¬è²»ï¼Œä½ å¯ä»¥è‡ªè¡Œè…¦è£œæ‰£é™¤å€‹äººèŠ±è²»)
        const leftMale = salaryMale - contribMale;
        const leftFemale = salaryFemale - contribFemale;
        const totalPersonalLeftMonthly = leftMale + leftFemale;

        // å¹´åº¦çé‡‘ (éš±è—è²¡å¯Œ)
        const yearlyBonus = (salaryMale + salaryFemale) * bonusMonths;

        // å¹´åº¦ç¸½æŠ•è³‡æ½›åŠ› (æ¯æœˆç›ˆé¤˜ x 12 + å¹´åº¦çé‡‘)
        // æ³¨æ„ï¼šå¦‚æœå…±åŒå¸³æˆ¶é€æ”¯ï¼Œè¦å…ˆå¡«è£œå‘æ´
        let monthlyTotalSurplus = totalPersonalLeftMonthly + jointBalance;
        const totalInvestable = (monthlyTotalSurplus * 12) + yearlyBonus;

        // 3. æ›´æ–°æ–‡å­—ä»‹é¢
        document.getElementById('valJointBalance').innerText = jointBalance.toLocaleString();
        document.getElementById('valPersonalLeft').innerText = totalPersonalLeftMonthly.toLocaleString();
        document.getElementById('valTotalInvest').innerText = totalInvestable.toLocaleString();

        const alertBox = document.getElementById('alertBox');
        if (jointBalance < 0) {
            alertBox.style.display = 'block';
            alertBox.innerText = `âš ï¸ è­¦å‘Šï¼šå…±åŒå¸³æˆ¶æ¯æœˆé€æ”¯ ${Math.abs(jointBalance)} å…ƒï¼`;
        } else {
            alertBox.style.display = 'none';
        }

        // 4. ç¹ªè£½ Canvas åœ–è¡¨
        drawJointChart(expMortgage, expLiving, jointBalance);
        drawYearChart((totalPersonalLeftMonthly * 12), yearlyBonus, (jointBalance * 12));
    }

    // ç¹ªè£½åœ“é¤…åœ– (å…±åŒå¸³æˆ¶)
    function drawJointChart(mortgage, living, balance) {
        const ctx = document.getElementById('jointChart').getContext('2d');
        
        // å¦‚æœæœ‰èˆŠåœ–è¡¨ï¼Œå…ˆéŠ·æ¯€
        if (jointChartInstance) jointChartInstance.destroy();

        // è™•ç†ç›ˆé¤˜é¡¯ç¤º (å¦‚æœé€æ”¯ï¼Œç›ˆé¤˜ç‚º0ï¼Œé¿å…åœ–è¡¨éŒ¯èª¤)
        const displayBalance = balance > 0 ? balance : 0;

        jointChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['æˆ¿è²¸', 'ç”Ÿæ´»é›œæ”¯', 'å…±åŒå¸³æˆ¶ç›ˆé¤˜'],
                datasets: [{
                    data: [mortgage, living, displayBalance],
                    backgroundColor: ['#e74c3c', '#f39c12', '#2ecc71'],
                    borderWidth: 1
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    // ç¹ªè£½é•·æ¢åœ– (å¹´åº¦åˆ†æ)
    function drawYearChart(personalYearly, bonusYearly, jointYearly) {
        const ctx = document.getElementById('yearChart').getContext('2d');
        
        if (yearChartInstance) yearChartInstance.destroy();

        // è™•ç†å…±åŒå¸³æˆ¶é€æ”¯çš„æƒ…æ³
        const displayJoint = jointYearly > 0 ? jointYearly : 0;
        const deficit = jointYearly < 0 ? jointYearly : 0;

        yearChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['è³‡é‡‘ä¾†æº'],
                datasets: [
                    { label: 'å¹³å¸¸æœˆè–ªçµé¤˜ (å€‹äºº)', data: [personalYearly], backgroundColor: '#3498db' },
                    { label: 'å¹³å¸¸æœˆè–ªçµé¤˜ (å…¬è²»)', data: [displayJoint], backgroundColor: '#2ecc71' },
                    { label: 'å¹´åº¦çé‡‘ (éš±è—è²¡å¯Œ)', data: [bonusYearly], backgroundColor: '#9b59b6' },
                    { label: 'é€æ”¯ç¼ºå£', data: [deficit], backgroundColor: '#e74c3c' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { x: { stacked: true }, y: { stacked: true } }
            }
        });
    }

    // é é¢è¼‰å…¥æ™‚å…ˆç®—ä¸€æ¬¡
    window.onload = calculate;
</script>

</body>
</html>
