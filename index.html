<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­è³‡é‡‘é‹ç”¨æˆ°æƒ…å®¤ (ç²¾æº–çé‡‘ç‰ˆ)</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #f8fafc; }
        .card { background: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 1.5rem; height: 100%; display: flex; flex-direction: column; }
        .input-row { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center; }
        .btn-add { background-color: #ecfdf5; color: #059669; border: 1px dashed #059669; width: 100%; padding: 0.5rem; border-radius: 0.375rem; transition: 0.2s; font-size: 0.9rem; }
        .btn-add:hover { background-color: #d1fae5; }
        .btn-del { color: #ef4444; cursor: pointer; padding: 0 5px; }
        .section-header { border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        input, select { border: 1px solid #d1d5db; padding: 0.4rem; border-radius: 0.25rem; font-size: 0.9rem; transition: border 0.2s; }
        input:focus { border-color: #3b82f6; outline: none; }
        .divider-bonus { margin-top: auto; border-top: 2px dashed #e5e7eb; padding-top: 1rem; margin-bottom: 1rem; }
        
        /* è¡¨æ ¼æ¨£å¼ */
        .etf-table { width: 100%; text-align: right; border-collapse: collapse; font-size: 0.9rem; }
        .etf-table th { background: #f1f5f9; padding: 8px; text-align: center; color: #475569; font-weight: bold; border-bottom: 2px solid #cbd5e1; }
        .etf-table td { padding: 8px; border-bottom: 1px solid #e2e8f0; }
        .etf-table tr:hover { background-color: #f8fafc; }

        /* å­˜æª”æç¤º */
        .save-toast { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 10px 20px; border-radius: 5px; opacity: 0; transition: opacity 0.5s; pointer-events: none; }
        .save-toast.show { opacity: 0.8; }
    </style>
</head>
<body>

<div id="app" class="p-4 max-w-[1400px] mx-auto pb-20 relative">
    
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-slate-700">ğŸ“Š å®¶åº­è³‡é‡‘é‹ç”¨æˆ°æƒ…å®¤ <span class="text-sm font-normal text-slate-500 block sm:inline">ç²¾æº–çé‡‘ç‰ˆ</span></h1>
        <button @click="resetData" class="text-sm bg-gray-200 hover:bg-gray-300 text-gray-600 px-3 py-2 rounded transition">
            ğŸ”„ æ¸…é™¤è³‡æ–™æ¢å¾©é è¨­
        </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        
        <div class="card border-t-4 border-blue-500">
            <div class="section-header">
                <h2 class="text-xl font-bold text-blue-700">ğŸ‘¨ ç”·ç”Ÿè²¡å‹™</h2>
            </div>
            <div class="space-y-4 mb-4">
                <div><label class="block text-sm font-bold text-gray-600">æœˆè–ªè³‡</label><input type="number" v-model.number="male.salary" class="w-full"></div>
                <div><label class="block text-sm font-bold text-gray-600">æ’¥å…¥å…±åŒå¸³æˆ¶</label><input type="number" v-model.number="male.contrib" class="w-full bg-blue-50"></div>
                <div>
                    <h3 class="font-bold text-gray-600 text-sm mb-2">å€‹äººé–‹éŠ·ç´°é …</h3>
                    <div v-for="(item, index) in male.expenses" :key="index" class="input-row">
                        <input type="text" v-model="item.name" placeholder="é …ç›®" class="w-1/3">
                        <input type="number" v-model.number="item.amount" placeholder="é‡‘é¡" class="w-1/3">
                        <select v-model="item.freq" class="w-1/4 text-xs"><option :value="1">æ¯æœˆ</option><option :value="2">æ¯2æœˆ</option><option :value="12">æ¯å¹´</option></select>
                        <span class="btn-del" @click="removeRow(male.expenses, index)">âœ•</span>
                    </div>
                    <button class="btn-add" @click="addRow(male.expenses)">+ æ–°å¢é–‹éŠ·</button>
                </div>
            </div>
            <div class="divider-bonus">
                <h3 class="font-bold text-blue-700 flex items-center gap-2">ğŸ§§ å¹´åº¦çé‡‘ç¸½é¡</h3>
                <div class="mt-2">
                    <label class="text-xs text-gray-500 block mb-1">åŒ…å«å¹´çµ‚ã€ä¸‰ç¯€ã€ç¸¾æ•ˆç­‰æ‰€æœ‰é¡å¤–æ”¶å…¥</label>
                    <div class="relative">
                        <span class="absolute left-3 top-2 text-gray-400">$</span>
                        <input type="number" v-model.number="male.bonusAmount" class="w-full p-2 pl-6 text-lg font-bold text-blue-700 bg-blue-50 border border-blue-200 rounded">
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-t-4 border-pink-500">
            <div class="section-header">
                <h2 class="text-xl font-bold text-pink-700">ğŸ‘© å¥³ç”Ÿè²¡å‹™</h2>
            </div>
            <div class="space-y-4 mb-4">
                <div><label class="block text-sm font-bold text-gray-600">æœˆè–ªè³‡</label><input type="number" v-model.number="female.salary" class="w-full"></div>
                <div><label class="block text-sm font-bold text-gray-600">æ’¥å…¥å…±åŒå¸³æˆ¶</label><input type="number" v-model.number="female.contrib" class="w-full bg-pink-50"></div>
                <div>
                    <h3 class="font-bold text-gray-600 text-sm mb-2">å€‹äººé–‹éŠ·ç´°é …</h3>
                    <div v-for="(item, index) in female.expenses" :key="index" class="input-row">
                        <input type="text" v-model="item.name" placeholder="é …ç›®" class="w-1/3">
                        <input type="number" v-model.number="item.amount" placeholder="é‡‘é¡" class="w-1/3">
                        <select v-model="item.freq" class="w-1/4 text-xs"><option :value="1">æ¯æœˆ</option><option :value="2">æ¯2æœˆ</option><option :value="12">æ¯å¹´</option></select>
                        <span class="btn-del" @click="removeRow(female.expenses, index)">âœ•</span>
                    </div>
                    <button class="btn-add" @click="addRow(female.expenses)">+ æ–°å¢é–‹éŠ·</button>
                </div>
            </div>
            <div class="divider-bonus">
                <h3 class="font-bold text-pink-700 flex items-center gap-2">ğŸ§§ å¹´åº¦çé‡‘ç¸½é¡</h3>
                <div class="mt-2">
                    <label class="text-xs text-gray-500 block mb-1">åŒ…å«å¹´çµ‚ã€ä¸‰ç¯€ã€ç¸¾æ•ˆç­‰æ‰€æœ‰é¡å¤–æ”¶å…¥</label>
                    <div class="relative">
                        <span class="absolute left-3 top-2 text-gray-400">$</span>
                        <input type="number" v-model.number="female.bonusAmount" class="w-full p-2 pl-6 text-lg font-bold text-pink-700 bg-pink-50 border border-pink-200 rounded">
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-t-4 border-green-500">
            <div class="section-header">
                <h2 class="text-xl font-bold text-green-700">ğŸ  å…±åŒå¸³æˆ¶</h2>
                <div class="text-sm text-green-600 bg-green-100 px-2 py-1 rounded">æœˆæ”¶: {{ formatMoney(male.contrib + female.contrib) }}</div>
            </div>
            <div class="space-y-2 flex-grow">
                <h3 class="font-bold text-gray-600 text-sm">å…±åŒæ”¯å‡ºç´°é …</h3>
                <div v-for="(item, index) in joint.expenses" :key="index" class="input-row">
                    <input type="text" v-model="item.name" placeholder="é …ç›®" class="w-1/3">
                    <input type="number" v-model.number="item.amount" placeholder="é‡‘é¡" class="w-1/3">
                    <select v-model="item.freq" class="w-1/4 text-xs"><option :value="1">æ¯æœˆ</option><option :value="2">æ¯2æœˆ</option><option :value="12">æ¯å¹´</option></select>
                    <span class="btn-del" @click="removeRow(joint.expenses, index)">âœ•</span>
                </div>
                <button class="btn-add" @click="addRow(joint.expenses)">+ æ–°å¢å…±åŒé–‹éŠ·</button>
            </div>
            <div class="mt-4 p-3 bg-green-100 rounded">
                <div class="flex justify-between items-end">
                    <div class="text-sm text-gray-600">æ¯æœˆç›ˆé¤˜</div>
                    <div :class="jointSurplus >= 0 ? 'text-green-700' : 'text-red-600'" class="text-2xl font-bold">{{ formatMoney(jointSurplus) }}</div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
        <div class="card bg-slate-800 text-white justify-center">
            <h2 class="text-2xl font-bold text-yellow-400 mb-6">ğŸ’° å®¶åº­å¹´åº¦è³‡é‡‘ç›¤é»</h2>
            <div class="space-y-6">
                <div class="border-b border-slate-600 pb-4">
                    <div class="flex justify-between items-end mb-2"><span class="text-lg">1. å¹³å¸¸æœˆè–ªçµé¤˜ (å¹´)</span><span class="font-mono text-xl text-yellow-200">{{ formatMoney(totalMonthlySurplusYearly) }}</span></div>
                    <div class="pl-4 text-xs text-gray-400 space-y-1">
                        <div class="flex justify-between"><span>â€¢ ç”·æ–¹å€‹äººæ¯æœˆå‰©é¤˜</span><span>{{ formatMoney(mMonthlyLeft) }} /æœˆ</span></div>
                        <div class="flex justify-between"><span>â€¢ å¥³æ–¹å€‹äººæ¯æœˆå‰©é¤˜</span><span>{{ formatMoney(fMonthlyLeft) }} /æœˆ</span></div>
                        <div class="flex justify-between"><span>â€¢ å…±åŒå¸³æˆ¶æ¯æœˆç›ˆé¤˜</span><span>{{ formatMoney(jointSurplus) }} /æœˆ</span></div>
                    </div>
                </div>
                <div class="border-b border-slate-600 pb-4">
                    <div class="flex justify-between items-end mb-2"><span class="text-lg">2. å¹´åº¦çé‡‘ç¸½é¡ (è¼¸å…¥å€¼)</span><span class="font-mono text-xl text-purple-300">{{ formatMoney(totalBonusYearly) }}</span></div>
                    <div class="pl-4 text-xs text-gray-400 space-y-1">
                         <div class="flex justify-between"><span>â€¢ ç”·æ–¹å¹´åº¦çé‡‘</span><span>{{ formatMoney(male.bonusAmount) }}</span></div>
                         <div class="flex justify-between"><span>â€¢ å¥³æ–¹å¹´åº¦çé‡‘</span><span>{{ formatMoney(female.bonusAmount) }}</span></div>
                    </div>
                </div>
                <div class="flex justify-between items-center pt-2">
                    <div><span class="text-xl font-bold block">ğŸš€ å¹´åº¦ç¸½æŠ•è³‡ç«åŠ›</span><span class="text-xs text-gray-400">(ç³»çµ±è‡ªå‹•å¸¶å…¥ä¸‹æ–¹è©¦ç®—)</span></div>
                    <span class="text-4xl font-bold text-green-400">{{ formatMoney(totalInvestable) }}</span>
                </div>
            </div>
            <div v-if="jointSurplus < 0" class="mt-6 p-3 bg-red-900/50 border border-red-500 rounded text-red-200 text-sm">âš ï¸ è­¦å‘Šï¼šå…±åŒå¸³æˆ¶æ¯æœˆé€æ”¯ï¼Œå·²æ‰£é™¤æ­¤ç¼ºå£ã€‚</div>
        </div>
        <div class="card">
            <h3 class="font-bold text-gray-700 mb-4">è³‡é‡‘æµå‘ (å«çé‡‘)</h3>
            <div class="h-64"><canvas id="financeChart"></canvas></div>
        </div>
    </div>

    <div class="card border-t-8 border-yellow-400 bg-gradient-to-b from-white to-yellow-50">
        <div class="section-header">
            <h2 class="text-2xl font-bold text-slate-800">ğŸ“ˆ ETF è¤‡åˆ©æˆé•·è©¦ç®—</h2>
            <div class="text-sm text-slate-500">ç”¨éŒ¢æ»¾éŒ¢ï¼Œé è¦‹æœªä¾†çš„è²¡å¯Œè‡ªç”±</div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-6">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-1">æ¯å¹´æŠ•å…¥é‡‘é¡</label>
                        <input type="number" v-model.number="etf.annualAmount" class="w-full text-lg font-bold text-green-600 bg-green-50 border-green-200">
                        <p class="text-xs text-gray-400 mt-1">é è¨­ç‚ºä¸Šæ–¹çš„å¹´åº¦ç¸½çµé¤˜</p>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-1">é ä¼°å¹´åŒ–æ®–åˆ©ç‡ (%)</label>
                        <input type="number" v-model.number="etf.rate" class="w-full text-lg font-bold text-blue-600 bg-blue-50 border-blue-200">
                        <p class="text-xs text-gray-400 mt-1">ä¸€èˆ¬ ETF ç´„ 5%~8%</p>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-1">æŠ•è³‡æŒçºŒå¹´é™</label>
                        <input type="number" v-model.number="etf.years" class="w-full text-lg font-bold text-purple-600 bg-purple-50 border-purple-200">
                    </div>
                </div>

                <div class="h-80 bg-white p-2 rounded-lg border border-gray-200">
                    <canvas id="etfChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden flex flex-col h-[500px]">
                <div class="p-3 bg-slate-100 border-b font-bold text-slate-700 text-center">å¹´åº¦è³‡ç”¢æˆé•·æ˜ç´°</div>
                <div class="overflow-y-auto flex-grow p-2">
                    <table class="etf-table">
                        <thead>
                            <tr>
                                <th>å¹´åº¦</th>
                                <th>ç´¯ç©æŠ•å…¥æœ¬é‡‘</th>
                                <th>åˆ©æ¯/æç›Š</th>
                                <th>æœŸæœ«ç¸½è³‡ç”¢</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="row in etfResult" :key="row.year">
                                <td class="text-center font-bold text-gray-500">ç¬¬ {{ row.year }} å¹´</td>
                                <td class="text-gray-600">{{ formatMoney(row.principal) }}</td>
                                <td class="text-green-600">+{{ formatMoney(row.interest) }}</td>
                                <td class="font-bold text-slate-800 bg-yellow-50">{{ formatMoney(row.total) }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="p-3 bg-yellow-100 text-right border-t border-yellow-200">
                    <div class="text-xs text-gray-600">ç´¯ç©ç¸½è³‡ç”¢</div>
                    <div class="text-2xl font-bold text-yellow-700">{{ formatMoney(etfResult[etfResult.length-1]?.total || 0) }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="saveToast" class="save-toast">è³‡æ–™å·²è‡ªå‹•å„²å­˜</div>

</div>

<script>
    const { createApp, ref, computed, watch, onMounted } = Vue;

    createApp({
        setup() {
            // --- å®šç¾©é è¨­è³‡æ–™ ---
            // æ³¨æ„ï¼šé€™è£¡æ”¹ç‚º bonusAmount ç›´æ¥è¨˜éŒ„é‡‘é¡
            const defaultMale = {
                salary: 60000, contrib: 30000, 
                bonusAmount: 300000, // é è¨­ 5 å€‹æœˆ x 6è¬ = 30è¬
                expenses: [
                    { name: 'æ‰‹æ©Ÿè²»', amount: 999, freq: 1 },
                    { name: 'åŠ æ²¹/äº¤é€š', amount: 3000, freq: 1 },
                    { name: 'å­è¦ªè²»', amount: 5000, freq: 1 },
                    { name: 'æ±½è»Šéšª', amount: 12000, freq: 12 }
                ]
            };

            const defaultFemale = {
                salary: 45000, contrib: 15000, 
                bonusAmount: 180000, // é è¨­ 4 å€‹æœˆ x 4.5è¬ = 18è¬
                expenses: [
                    { name: 'åŒ–å¦/ä¿é¤Š', amount: 2000, freq: 1 },
                    { name: 'å­è¦ªè²»', amount: 5000, freq: 1 },
                    { name: 'é†«ç™‚éšª', amount: 24000, freq: 12 }
                ]
            };

            const defaultJoint = {
                expenses: [
                    { name: 'æˆ¿è²¸', amount: 25000, freq: 1 },
                    { name: 'ç®¡ç†è²»', amount: 2500, freq: 1 },
                    { name: 'ç¶²è·¯è²»', amount: 800, freq: 1 },
                    { name: 'é›»è²»', amount: 3000, freq: 2 },  
                    { name: 'æ°´è²»', amount: 500, freq: 2 },   
                    { name: 'æˆ¿å±‹/åœ°åƒ¹ç¨…', amount: 8000, freq: 12 }, 
                    { name: 'å…±åŒé£²é£Ÿ/æ—¥ç”¨', amount: 12000, freq: 1 }
                ]
            };
            
            const defaultEtf = { annualAmount: 0, rate: 5, years: 10 };

            // --- éŸ¿æ‡‰å¼è®Šæ•¸ ---
            const male = ref(JSON.parse(JSON.stringify(defaultMale)));
            const female = ref(JSON.parse(JSON.stringify(defaultFemale)));
            const joint = ref(JSON.parse(JSON.stringify(defaultJoint)));
            const etf = ref(JSON.parse(JSON.stringify(defaultEtf)));

            // --- å­˜æª”/è®€æª”é‚è¼¯ ---
            // å‡ç´šå­˜æª” Keyï¼Œé¿å…èˆ‡èˆŠç‰ˆè³‡æ–™çµæ§‹è¡çª
            const STORAGE_KEY = 'family_finance_data_v2';

            const loadData = () => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        male.value = { ...defaultMale, ...parsed.male };
                        female.value = { ...defaultFemale, ...parsed.female };
                        joint.value = { ...defaultJoint, ...parsed.joint };
                        etf.value = { ...defaultEtf, ...parsed.etf };
                    } catch (e) {
                        console.error('è®€å–å­˜æª”å¤±æ•—', e);
                    }
                }
            };

            const resetData = () => {
                if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™ä¸¦æ¢å¾©é è¨­å€¼å—ï¼Ÿ')) {
                    male.value = JSON.parse(JSON.stringify(defaultMale));
                    female.value = JSON.parse(JSON.stringify(defaultFemale));
                    joint.value = JSON.parse(JSON.stringify(defaultJoint));
                    etf.value = JSON.parse(JSON.stringify(defaultEtf));
                    localStorage.removeItem(STORAGE_KEY);
                    location.reload();
                }
            };

            const showSaveToast = () => {
                const toast = document.getElementById('saveToast');
                if(toast) {
                    toast.classList.add('show');
                    setTimeout(() => toast.classList.remove('show'), 1500);
                }
            };

            // --- åŸºç¤è¨ˆç®—é‚è¼¯ ---
            const calcTotalMonthly = (list) => list.reduce((sum, item) => sum + (item.amount / item.freq), 0);
            const formatMoney = (val) => Math.round(val).toLocaleString();

            const jointSurplus = computed(() => (male.value.contrib + female.value.contrib) - calcTotalMonthly(joint.value.expenses));
            const mMonthlyLeft = computed(() => male.value.salary - male.value.contrib - calcTotalMonthly(male.value.expenses));
            const fMonthlyLeft = computed(() => female.value.salary - female.value.contrib - calcTotalMonthly(female.value.expenses));
            
            const totalMonthlySurplusYearly = computed(() => (mMonthlyLeft.value + fMonthlyLeft.value + jointSurplus.value) * 12);
            
            // ç›´æ¥ä½¿ç”¨è¼¸å…¥çš„çé‡‘é‡‘é¡
            const totalBonusYearly = computed(() => male.value.bonusAmount + female.value.bonusAmount);
            
            const totalInvestable = computed(() => totalMonthlySurplusYearly.value + totalBonusYearly.value);

            // --- ETF é‚è¼¯ ---
            watch(totalInvestable, (newVal) => {
                etf.value.annualAmount = Math.max(0, Math.round(newVal));
            });

            const etfResult = computed(() => {
                const results = [];
                let currentTotal = 0;
                let totalPrincipal = 0;
                const r = etf.value.rate / 100;
                for(let i = 1; i <= etf.value.years; i++) {
                    totalPrincipal += etf.value.annualAmount;
                    currentTotal = (currentTotal + etf.value.annualAmount) * (1 + r);
                    results.push({ year: i, principal: totalPrincipal, total: currentTotal, interest: currentTotal - totalPrincipal });
                }
                return results;
            });

            // --- åœ–è¡¨ç¹ªè£½ ---
            let financeChart = null;
            let etfChart = null;

            const updateCharts = () => {
                // 1. è³‡é‡‘åœ“é¤…åœ–
                const ctx1 = document.getElementById('financeChart').getContext('2d');
                if(financeChart) financeChart.destroy();
                const jExp = calcTotalMonthly(joint.value.expenses);
                const mExp = calcTotalMonthly(male.value.expenses);
                const fExp = calcTotalMonthly(female.value.expenses);
                const invest = totalInvestable.value / 12;

                financeChart = new Chart(ctx1, {
                    type: 'doughnut',
                    data: {
                        labels: ['å…±åŒé–‹éŠ·', 'ç”·å€‹äºº', 'å¥³å€‹äºº', 'æŠ•è³‡æ½›åŠ›'],
                        datasets: [{
                            data: [jExp, mExp, fExp, invest],
                            backgroundColor: ['#10b981', '#3b82f6', '#ec4899', '#f59e0b']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
                });

                // 2. ETF æˆé•·æ›²ç·šåœ–
                const ctx2 = document.getElementById('etfChart').getContext('2d');
                if(etfChart) etfChart.destroy();
                const labels = etfResult.value.map(r => `ç¬¬${r.year}å¹´`);
                const dataPrincipal = etfResult.value.map(r => r.principal);
                const dataTotal = etfResult.value.map(r => r.total);

                etfChart = new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'ç´¯ç©ç¸½è³‡ç”¢ (è¤‡åˆ©)', data: dataTotal, borderColor: '#ca8a04', backgroundColor: 'rgba(202, 138, 4, 0.1)', fill: true, tension: 0.3 },
                            { label: 'åƒ…æŠ•å…¥æœ¬é‡‘', data: dataPrincipal, borderColor: '#94a3b8', borderDash: [5, 5], tension: 0.1 }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        interaction: { intersect: false, mode: 'index' },
                        plugins: { tooltip: { callbacks: { label: (c) => c.dataset.label + ': ' + Math.round(c.raw).toLocaleString() } } }
                    }
                });
            };

            // ç›£è½è®Šå‹•ä¸¦å­˜æª”
            watch([male, female, joint, etf], () => {
                const dataToSave = {
                    male: male.value,
                    female: female.value,
                    joint: joint.value,
                    etf: etf.value
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                setTimeout(updateCharts, 100);
            }, { deep: true });

            onMounted(() => {
                loadData(); 
                setTimeout(updateCharts, 500);
            });

            return {
                male, female, joint, etf, etfResult,
                mMonthlyLeft, fMonthlyLeft, jointSurplus,
                totalMonthlySurplusYearly, totalBonusYearly, totalInvestable,
                addRow: (list) => list.push({ name: '', amount: 0, freq: 1 }),
                removeRow: (list, idx) => list.splice(idx, 1),
                formatMoney, resetData
            };
        }
    }).mount('#app');
</script>

</body>
</html>
